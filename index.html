<!DOCTYPE html>
<html lang="fr">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CFTR7X9CWW"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-CFTR7X9CWW');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gourmet Finder - Votre Guide Gastronomique Mondial</title>
    <script async custom-element="amp-auto-ads"
      src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    <script>
(function(ljkur){
var d = document,
    s = d.createElement('script'),
    l = d.scripts[d.scripts.length - 1];
s.settings = ljkur || {};
s.src = "\/\/jumpyliterature.com\/bJX.VlswdUGKls0\/YHWxcM\/Wetmz9XusZBUblZk\/P\/TlYe2NO_DwYixwMXzhE\/t\/NljiYh4JNBjbEWzqM\/gB";
s.async = true;
s.referrerPolicy = 'no-referrer-when-downgrade';
l.parentNode.insertBefore(s, l);
})({})
</script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6536893719603715"
      crossorigin="anonymous"></script>
    <script>
(function(wmhipo){
var d = document,
    s = d.createElement('script'),
    l = d.scripts[d.scripts.length - 1];
s.settings = wmhipo || {};
s.src = "\/\/jumpyliterature.com\/bKX_Vdsxd.GFlY0ZYiWecd\/Ye\/mV9\/uTZwUvlMk-P\/T\/Ys2XOuDyYkxQMBjwMKtfNDjyYQ4KNYjbEpy\/NjAc";
s.async = true;
s.referrerPolicy = 'no-referrer-when-downgrade';
l.parentNode.insertBefore(s, l);
})({})
</script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-text {
            background: linear-gradient(to right, #4ade80, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }
        .modal-enter {
            animation: fadeIn 0.3s ease-out forwards;
        }
        .modal-leave {
            animation: fadeOut 0.3s ease-in forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.95); }
        }
        .chat-bubble-user {
            background-color: #3b82f6;
            color: white;
            align-self: flex-end;
        }
        .chat-bubble-gemini {
            background-color: #e5e7eb;
            color: #1f2937;
            align-self: flex-start;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #2a364d;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        .star-rating label {
            cursor: pointer;
            color: #4b5563; /* Gray stars */
            transition: color 0.2s;
        }
        .star-rating input:checked ~ label,
        .star-rating label:hover,
        .star-rating label:hover ~ label {
            color: #f59e0b; /* Yellow stars */
        }
        .star-rating input {
            display: none;
        }
        .filter-btn[data-active="true"] {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
    </style>
</head>
<body class="bg-slate-900 text-white antialiased">

    <amp-auto-ads type="adsense"
        data-ad-client="ca-pub-6536893719603715">
    </amp-auto-ads>
    
    <div class="container mx-auto px-4 py-8 min-h-screen">
        <header class="text-center mb-8 relative">
            <h1 class="text-4xl md:text-5xl font-extrabold gradient-text">Gourmet Finder</h1>
            <p class="text-slate-400 mt-2">Votre guide gastronomique mondial, propulsé par Gemini & Google.</p>
            <button id="open-about-modal-btn" class="absolute top-0 right-0 bg-slate-800 hover:bg-slate-700 text-slate-300 font-semibold py-2 px-4 rounded-lg transition-colors text-sm">
                À Propos & Avis
            </button>
        </header>

        <div class="sticky top-0 z-20 bg-slate-900/80 backdrop-blur-lg py-4 mb-4">
            <form id="search-form" class="max-w-3xl mx-auto mb-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="text" id="city-input" placeholder="Ville ou Région (ex: Paris)" class="w-full bg-slate-800 border border-slate-700 rounded-lg py-2.5 px-4 text-white placeholder-slate-500 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                <input type="text" id="specific-search-input" placeholder="Plat ou nom de restaurant (ex: Pizza)" class="w-full bg-slate-800 border border-slate-700 rounded-lg py-2.5 px-4 text-white placeholder-slate-500 focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </form>
            
            <div class="max-w-4xl mx-auto">
                <div class="mb-4">
                    <p class="text-sm font-semibold text-slate-400 mb-2 text-center">Filtres populaires</p>
                    <div id="tag-filters" class="flex flex-wrap justify-center gap-2">
                        <button class="filter-btn border border-slate-600 bg-slate-700 text-slate-300 px-3 py-1.5 rounded-full text-xs font-semibold transition-all" data-value="gastronomique">Gastronomique</button>
                        <button class="filter-btn border border-slate-600 bg-slate-700 text-slate-300 px-3 py-1.5 rounded-full text-xs font-semibold transition-all" data-value="étoilé Michelin">Étoilé Michelin</button>
                        <button class="filter-btn border border-slate-600 bg-slate-700 text-slate-300 px-3 py-1.5 rounded-full text-xs font-semibold transition-all" data-value="Bib Gourmand">Bib Gourmand</button>
                        <button class="filter-btn border border-slate-600 bg-slate-700 text-slate-300 px-3 py-1.5 rounded-full text-xs font-semibold transition-all" data-value="chaleureux">Chaleureux</button>
                        <button class="filter-btn border border-slate-600 bg-slate-700 text-slate-300 px-3 py-1.5 rounded-full text-xs font-semibold transition-all" data-value="bien noté">Bien noté</button>
                        <button class="filter-btn border border-slate-600 bg-slate-700 text-slate-300 px-3 py-1.5 rounded-full text-xs font-semibold transition-all" data-value="pizzeria">Pizzeria</button>
                        <button class="filter-btn border border-slate-600 bg-slate-700 text-slate-300 px-3 py-1.5 rounded-full text-xs font-semibold transition-all" data-value="kebab">Kebab</button>
                    </div>
                </div>
                <div class="flex justify-between items-center">
                    <select id="sort-select" class="bg-slate-800 border border-slate-700 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                        <option value="">Trier par pertinence</option>
                        <option value="du plus cher au moins cher">Prix : Décroissant</option>
                        <option value="du moins cher au plus cher">Prix : Croissant</option>
                        <option value="les mieux notés">Meilleure note</option>
                    </select>
                    <button id="search-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition-colors flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m21 21-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z"></path></svg>
                        Rechercher
                    </button>
                </div>
            </div>
        </div>

        <main id="results-container" class="max-w-7xl mx-auto">
            <div id="loader" class="hidden justify-center items-center py-16">
                <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-500"></div>
            </div>
            <div id="initial-message" class="text-center py-16 text-slate-500">
                <p>Utilisez les filtres ci-dessus pour lancer une recherche détaillée.</p>
            </div>
            <div id="error-message" class="hidden text-center py-16 text-red-400"></div>
            <div id="results-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </main>
    </div>

    <div id="details-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden items-center justify-center p-4">
        <div id="modal-content" class="bg-slate-800 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl relative"></div>
    </div>
    
    <div id="about-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden items-center justify-center p-4">
        <div class="bg-slate-800 rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-2xl relative p-8">
            <button id="close-about-modal-btn" class="absolute top-4 right-4 text-slate-400 hover:text-white z-10 bg-slate-900/50 rounded-full p-1"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
            <main>
                <section id="features" class="mb-16">
                    <h2 class="text-4xl font-bold text-center mb-12 gradient-text">Une Révolution dans votre Assiette</h2>
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                        <div class="bg-slate-900 p-6 rounded-xl text-center"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto mb-4 text-green-400"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg><h3 class="text-xl font-bold mb-2">Recherche Mondiale</h3><p class="text-slate-400 text-sm">Trouvez les perles rares, des restaurants aux boutiques spécialisées, dans n'importe quelle ville du monde.</p></div>
                        <div class="bg-slate-900 p-6 rounded-xl text-center"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto mb-4 text-green-400"><path d="M21.5 12H16c-.7 2-2 3-4 3s-3.3-1-4-3H2.5"></path><path d="M5.5 5.1L2 12v6c0 1.1.9 2 2 2h16a2 2 0 002-2v-6l-3.4-6.9A2 2 0 0016.8 4H7.2a2 2 0 00-1.7 1.1z"></path></svg><h3 class="text-xl font-bold mb-2">Détails Complets</h3><p class="text-slate-400 text-sm">Accédez aux menus, prix, notes, adresses, photos et itinéraires pour faire le bon choix.</p></div>
                        <div class="bg-slate-900 p-6 rounded-xl text-center"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto mb-4 text-green-400"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg><h3 class="text-xl font-bold mb-2">Assistant Culinaire</h3><p class="text-slate-400 text-sm">Notre chatbot répond à tout : recettes, accords mets-vins, histoire d'un plat, etc.</p></div>
                        <div class="bg-slate-900 p-6 rounded-xl text-center"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto mb-4 text-green-400"><path d="M19 21l-7-5-7 5V5a2 2 0 012-2h10a2 2 0 012 2z"></path></svg><h3 class="text-xl font-bold mb-2">Avis Communautaires</h3><p class="text-slate-400 text-sm">Partagez vos expériences et consultez celles des autres pour des choix toujours plus éclairés.</p></div>
                    </div>
                </section>
                <section id="reviews">
                    <h2 class="text-4xl font-bold text-center mb-12">La Communauté des Gourmets</h2>
                    <div class="grid lg:grid-cols-2 gap-12">
                        <div class="bg-slate-900 p-8 rounded-2xl"><h3 class="text-2xl font-bold mb-6">Partagez votre expérience</h3><form id="review-form"><div class="mb-4"><label for="reviewer-name" class="block mb-2 text-sm font-medium text-slate-300">Votre nom</label><input type="text" id="reviewer-name" class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="Ex: Jean Dupont" required></div><div class="mb-4"><label for="place-name" class="block mb-2 text-sm font-medium text-slate-300">Nom du lieu</label><input type="text" id="place-name" class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="Ex: Le Bistrot Gourmand" required></div><div class="mb-4"><label class="block mb-2 text-sm font-medium text-slate-300">Votre note</label><div class="star-rating flex flex-row-reverse justify-end text-3xl"><input type="radio" id="star5" name="rating" value="5" required/><label for="star5" title="5 stars">★</label><input type="radio" id="star4" name="rating" value="4" /><label for="star4" title="4 stars">★</label><input type="radio" id="star3" name="rating" value="3" /><label for="star3" title="3 stars">★</label><input type="radio" id="star2" name="rating" value="2" /><label for="star2" title="2 stars">★</label><input type="radio" id="star1" name="rating" value="1" /><label for="star1" title="1 star">★</label></div></div><div class="mb-6"><label for="review-text" class="block mb-2 text-sm font-medium text-slate-300">Votre avis</label><textarea id="review-text" rows="4" class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="Écrivez votre avis ici..." required></textarea></div><button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">Publier mon avis</button></form></div>
                        <div id="reviews-list" class="space-y-6"><div class="bg-slate-900 p-6 rounded-xl"><div class="flex items-start justify-between mb-2"><div><p class="font-bold text-lg">Marie Claire</p><p class="text-sm text-slate-400">sur "La Trattoria del Ponte"</p></div><div class="text-yellow-400 text-xl">★★★★★</div></div><p class="text-slate-300 mb-4">Une expérience incroyable ! Les pâtes aux truffes étaient divines. Service impeccable. Je recommande vivement !</p><div class="text-right"><button class="reply-btn text-sm text-blue-400 hover:underline">Répondre</button></div><div class="reply-section hidden mt-4 pl-6 border-l-2 border-slate-700"></div></div></div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <div id="chatbot-container">
        <button id="chatbot-toggle" class="fixed bottom-6 right-6 bg-green-500 hover:bg-green-600 text-white rounded-full p-4 shadow-lg transition-transform hover:scale-110"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg></button>
        <div id="chatbot-window" class="hidden fixed bottom-24 right-6 w-[90vw] max-w-sm h-[60vh] bg-slate-800 rounded-2xl shadow-2xl flex flex-col transition-all origin-bottom-right">
            <div class="flex items-center justify-between p-4 bg-slate-700 rounded-t-2xl"><h3 class="font-bold text-lg">Assistant Gourmet</h3><button id="chatbot-close" class="text-slate-400 hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div>
            <div id="chat-messages" class="flex-1 p-4 overflow-y-auto flex flex-col space-y-3"><div class="chat-bubble-gemini p-3 rounded-lg max-w-xs">Bonjour ! Demandez-moi une recette ou posez-moi une question culinaire.</div></div>
            <div id="chat-loader" class="hidden p-4 flex items-center space-x-2"><div class="chat-bubble-gemini p-3 rounded-lg"><div class="flex items-center space-x-1"><span class="w-2 h-2 bg-slate-500 rounded-full animate-bounce " style="animation-delay: 0s;"></span><span class="w-2 h-2 bg-slate-500 rounded-full animate-bounce" style="animation-delay: 0.2s;"></span><span class="w-2 h-2 bg-slate-500 rounded-full animate-bounce" style="animation-delay: 0.4s;"></span></div></div></div>
            <form id="chat-form" class="p-4 border-t border-slate-700"><div class="relative"><input type="text" id="chat-input" placeholder="Votre message..." class="w-full bg-slate-700 border border-slate-600 rounded-full py-2 pl-4 pr-12 text-white placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:outline-none"><button type="submit" class="absolute top-1/2 right-2 -translate-y-1/2 text-green-400 hover:text-green-300 p-1.5"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg></button></div></form>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const cityInput = document.getElementById('city-input');
        const specificSearchInput = document.getElementById('specific-search-input');
        const tagFiltersContainer = document.getElementById('tag-filters');
        const sortSelect = document.getElementById('sort-select');
        const searchButton = document.getElementById('search-button');
        const resultsGrid = document.getElementById('results-grid');
        const initialMessage = document.getElementById('initial-message');
        const errorMessage = document.getElementById('error-message');
        const loader = document.getElementById('loader');
        
        const detailsModal = document.getElementById('details-modal');
        const modalContent = document.getElementById('modal-content');
        const aboutModal = document.getElementById('about-modal');
        const openAboutModalBtn = document.getElementById('open-about-modal-btn');
        const closeAboutModalBtn = document.getElementById('close-about-modal-btn');
        
        const chatbotToggle = document.getElementById('chatbot-toggle');
        const chatbotWindow = document.getElementById('chatbot-window');
        const chatbotClose = document.getElementById('chatbot-close');
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const chatMessages = document.getElementById('chat-messages');
        const chatLoader = document.getElementById('chat-loader');

        const reviewForm = document.getElementById('review-form');
        const reviewsList = document.getElementById('reviews-list');

        // --- Gemini API Configuration ---
        const API_KEY = "AIzaSyBwnXR2pgdAVplrWOrPTpxfY39eK14wb5E";
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`;
        
        // --- Functions ---
        
        async function callGeminiAPI(systemPrompt, userQuery, retries = 3, delay = 1000) {
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                tools: [{ "google_search": {} }]
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    if (response.status === 429 && retries > 0) {
                        await new Promise(res => setTimeout(res, delay));
                        return callGeminiAPI(systemPrompt, userQuery, retries - 1, delay * 2);
                    }
                    const errorBody = await response.json();
                    throw new Error(`API Error: ${errorBody.error?.message || response.statusText} (Status: ${response.status})`);
                }
                const result = await response.json();
                const candidate = result.candidates?.[0];
                if (candidate && candidate.content?.parts?.[0]?.text) {
                    return candidate.content.parts[0].text;
                } else {
                     if (result.promptFeedback?.blockReason) {
                         throw new Error(`La requête a été bloquée : ${result.promptFeedback.blockReason}`);
                     }
                    throw new Error('Réponse invalide ou vide de l\'API Gemini.');
                }
            } catch (error) {
                 console.error("Error calling Gemini API:", error);
                 throw error;
            }
        }

        async function handleSearch() {
            const city = cityInput.value.trim();
            if (!city) {
                showError("Veuillez entrer une ville pour lancer la recherche.");
                return;
            }

            initialMessage.classList.add('hidden');
            errorMessage.classList.add('hidden');
            resultsGrid.innerHTML = '';
            loader.style.display = 'flex';

            const specificSearch = specificSearchInput.value.trim();
            const sortOrder = sortSelect.value;
            const activeTags = Array.from(tagFiltersContainer.querySelectorAll('[data-active="true"]'))
                                         .map(btn => btn.dataset.value);

            let userQuery = `Trouve les 6 meilleurs restaurants ou boutiques alimentaires à "${city}".`;
            if (specificSearch) {
                userQuery += ` qui correspondent à "${specificSearch}".`;
            }
            if (activeTags.length > 0) {
                userQuery += ` Applique les filtres suivants : ${activeTags.join(', ')}.`;
            }
            if (sortOrder) {
                userQuery += ` Trie les résultats par : ${sortOrder}.`;
            }

            const systemPrompt = `
                Tu es un guide local expert. Ta mission est de trouver des établissements réels et vérifiables.
                Réponds UNIQUEMENT avec un tableau JSON valide (une chaîne de caractères). N'inclus pas les \`\`\`json ... \`\`\` ou d'autres explications.
                Chaque objet doit contenir : "nom", "type", "description", "adresse", "note" (nombre), "prix", "telephone", "menu" (tableau de chaînes), "websiteUrl" (URL valide ou "non disponible"), et "imageUrls" (un tableau de 3 URLs d'images valides et directes de l'établissement).
                Utilise intensivement ton outil de recherche pour garantir que toutes les informations (surtout les URLs des images et du site) sont réelles, fonctionnelles et à jour.
            `;
            
            try {
                const responseText = await callGeminiAPI(systemPrompt, userQuery);
                const cleanedText = responseText.replace(/```json/g, '').replace(/```/g, '').trim();
                const results = JSON.parse(cleanedText);
                displayResults(results);
            } catch (error) {
                showError(`Désolé, une erreur est survenue. L'IA n'a pas pu formater les résultats. Essayez une autre recherche. Détail: ${error.message}`);
            } finally {
                loader.style.display = 'none';
            }
        }

        function displayResults(results) {
            resultsGrid.innerHTML = '';
            if (!results || results.length === 0) {
                 showError("Aucun résultat trouvé. Essayez d'élargir vos critères de recherche.");
                 return;
            }

            results.forEach(place => {
                const card = document.createElement('div');
                card.className = 'bg-slate-800 rounded-xl overflow-hidden cursor-pointer transform hover:-translate-y-1 transition-transform duration-300 flex flex-col';
                card.innerHTML = `
                    <div class="relative"><img src="${place.imageUrls[0]}" alt="Image de ${place.nom}" class="w-full h-48 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/1e293b/94a3b8?text=Image+Indisponible';"></div>
                    <div class="p-5 flex flex-col flex-grow">
                        <h3 class="text-xl font-bold text-green-400">${place.nom}</h3>
                        <p class="text-sm text-slate-400 mb-2">${place.type}</p>
                        <div class="flex items-center space-x-4 text-sm mb-3">
                            <div class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="text-yellow-400 mr-1"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"></path></svg><span class="font-semibold">${place.note}</span></div>
                            <span class="font-bold text-slate-300">${place.prix}</span>
                        </div>
                        <p class="text-slate-300 text-sm leading-relaxed flex-grow">${place.description}</p>
                    </div>
                `;
                card.addEventListener('click', () => showDetailsModal(place));
                resultsGrid.appendChild(card);
            });
        }
        
        function showDetailsModal(place) {
            let imagesHTML = place.imageUrls.map(url => `<img src="${url}" class="w-full h-32 object-cover rounded-lg" onerror="this.style.display='none'">`).join('');
            let menuHTML = place.menu && place.menu.length > 0 
                ? `
                    <h3 class="text-xl font-semibold mb-3 text-green-400">Menu / Produits Phares</h3>
                    <ul class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-2 mb-6 list-disc list-inside text-slate-300">
                        ${place.menu.map(item => `<li>${item}</li>`).join('')}
                    </ul>`
                : '<p class="text-slate-400 mb-6">Le menu n\'est pas disponible actuellement.</p>';
            
            let websiteButton = place.websiteUrl && place.websiteUrl !== 'non disponible'
                ? `<a href="${place.websiteUrl}" target="_blank" class="inline-flex items-center justify-center bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full w-full transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.72"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.72-1.72"></path></svg>Visiter le site web</a>`
                : '';

            modalContent.innerHTML = `
                <button class="close-modal-btn absolute top-4 right-4 text-slate-400 hover:text-white z-10 bg-slate-900/50 rounded-full p-1"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                <img src="${place.imageUrls[0]}" alt="Image principale de ${place.nom}" class="w-full h-64 object-cover rounded-t-2xl" onerror="this.style.display='none'">
                <div class="p-6 md:p-8">
                    <h2 class="text-3xl font-bold gradient-text mb-2">${place.nom}</h2>
                    <p class="text-slate-400 mb-4">${place.type}</p>
                    <div class="grid grid-cols-3 gap-2 mb-6">${imagesHTML}</div>
                    <p class="text-slate-300 mb-6">${place.description}</p>
                    ${menuHTML}
                    <div class="border-t border-slate-700 pt-6 space-y-4">
                        <p><strong>Adresse:</strong> ${place.adresse}</p>
                        <p><strong>Téléphone:</strong> ${place.telephone}</p>
                        <div class="grid grid-cols-1 ${websiteButton ? 'sm:grid-cols-2' : ''} gap-4">
                            <a href="https://www.google.com/maps/search/?api=1&query=$${encodeURIComponent(place.adresse)}" target="_blank" class="inline-flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full w-full transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg>Itinéraire</a>
                            ${websiteButton}
                        </div>
                    </div>
                </div>
            `;
            detailsModal.classList.remove('hidden');
            detailsModal.classList.add('flex', 'modal-enter');
            detailsModal.classList.remove('modal-leave');
            detailsModal.querySelector('.close-modal-btn').addEventListener('click', hideDetailsModal);
        }

        function hideDetailsModal() {
            detailsModal.classList.add('modal-leave');
            detailsModal.classList.remove('modal-enter');
            setTimeout(() => {
                detailsModal.classList.add('hidden');
                detailsModal.classList.remove('flex');
            }, 300);
        }
        
        function showError(message) {
            resultsGrid.innerHTML = '';
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
        }

        // --- Event Listeners ---
        searchButton.addEventListener('click', handleSearch);
        document.getElementById('search-form').addEventListener('submit', (e) => {
            e.preventDefault();
            handleSearch();
        });

        tagFiltersContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('filter-btn')) {
                const button = e.target;
                const isActive = button.dataset.active === 'true';
                button.dataset.active = !isActive;
            }
        });

        detailsModal.addEventListener('click', (e) => {
            if (e.target === detailsModal) { hideDetailsModal(); }
        });

        // --- About Modal Logic ---
        openAboutModalBtn.addEventListener('click', () => {
            aboutModal.classList.remove('hidden');
            aboutModal.classList.add('flex', 'modal-enter');
            aboutModal.classList.remove('modal-leave');
        });

        closeAboutModalBtn.addEventListener('click', () => {
            aboutModal.classList.add('modal-leave');
            aboutModal.classList.remove('modal-enter');
            setTimeout(() => {
                aboutModal.classList.add('hidden');
                aboutModal.classList.remove('flex');
            }, 300);
        });

        aboutModal.addEventListener('click', (e) => {
            if (e.target === aboutModal) {
                aboutModal.classList.add('modal-leave');
                aboutModal.classList.remove('modal-enter');
                setTimeout(() => {
                    aboutModal.classList.add('hidden');
                    aboutModal.classList.remove('flex');
                }, 300);
            }
        });

        // --- Review Form Logic (Basic) ---
        reviewForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('reviewer-name').value;
            const place = document.getElementById('place-name').value;
            const rating = reviewForm.querySelector('input[name="rating"]:checked').value;
            const reviewText = document.getElementById('review-text').value;

            // Simple display of the new review (not stored permanently as this is frontend code)
            const newReviewHTML = `
                <div class="bg-slate-900 p-6 rounded-xl">
                    <div class="flex items-start justify-between mb-2">
                        <div>
                            <p class="font-bold text-lg">${name}</p>
                            <p class="text-sm text-slate-400">sur "${place}"</p>
                        </div>
                        <div class="text-yellow-400 text-xl">${'★'.repeat(parseInt(rating))}</div>
                    </div>
                    <p class="text-slate-300 mb-4">${reviewText}</p>
                    <div class="text-right"><button class="reply-btn text-sm text-blue-400 hover:underline">Répondre</button></div>
                    <div class="reply-section hidden mt-4 pl-6 border-l-2 border-slate-700"></div>
                </div>
            `;
            reviewsList.insertAdjacentHTML('afterbegin', newReviewHTML);
            reviewForm.reset();
            alert("Avis soumis (note: l'avis n'est pas sauvegardé de manière permanente).");
        });

        // --- Chatbot Logic (Simplified) ---
        let chatHistory = [{ role: 'model', parts: [{ text: 'Bonjour ! Demandez-moi une recette ou posez-moi une question culinaire.' }] }];

        chatbotToggle.addEventListener('click', () => {
            chatbotWindow.classList.toggle('hidden');
        });

        chatbotClose.addEventListener('click', () => {
            chatbotWindow.classList.add('hidden');
        });

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const userMessage = chatInput.value.trim();
            chatInput.value = '';
            if (!userMessage) return;

            // 1. Display user message
            appendMessage(userMessage, 'user');

            // 2. Add to history
            chatHistory.push({ role: 'user', parts: [{ text: userMessage }] });

            // 3. Show loader and prepare for API call
            chatLoader.classList.remove('hidden');
            chatMessages.scrollTop = chatMessages.scrollHeight;

            const chatSystemPrompt = `Tu es un assistant culinaire nommé "Assistant Gourmet". Réponds de manière chaleureuse, précise et utile. Utilise l'outil de recherche Google pour trouver des informations de manière dynamique pour répondre aux requêtes de recettes, d'accords mets-vins, ou de faits culinaires.`;

            try {
                // The API call logic for a chat is more complex than a simple prompt due to history
                // We'll use a simplified call for this demo, focusing on the last message for now.
                // A true chat would require sending the full chatHistory in the API request.
                const responseText = await callGeminiAPI(chatSystemPrompt, userMessage);
                
                // 4. Display Gemini response
                appendMessage(responseText, 'gemini');

                // 5. Update history (ideally, with the full response)
                chatHistory.push({ role: 'model', parts: [{ text: responseText }] });

            } catch (error) {
                appendMessage("Désolé, je n'ai pas pu vous répondre. Erreur de connexion ou de l'API.", 'gemini');
                console.error("Chatbot Error:", error);
            } finally {
                // 6. Hide loader and scroll
                chatLoader.classList.add('hidden');
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        });

        function appendMessage(text, sender) {
            const messageElement = document.createElement('div');
            messageElement.className = `chat-bubble-${sender} p-3 rounded-lg max-w-xs whitespace-pre-wrap`;
            messageElement.textContent = text;
            chatMessages.appendChild(messageElement);
        }

        // --- Initialization ---
        // Force scroll down on load for the initial chat message
        window.addEventListener('load', () => {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        });
        
    </script>
</body>
</html>



